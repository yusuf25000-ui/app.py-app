import streamlit as st
import pandas as pd
from datetime import datetime

# ุฅุนุฏุงุฏ ูุงุฌูุฉ ุงูุจุฑูุงูุฌ ูุชููู ุนุฑูุถุฉ ูููุงุณุจุฉ ููุฌุฏุงูู
st.set_page_config(page_title="ููุฎุต ุงูุจูุงู ุงูุฌูุฑูู", layout="wide")

st.title("๐ ูุธุงู ููุฎุต ุจูุงู ุงูุฑุณูู ุงูุฌูุฑููุฉ")
st.info("ูู ุจุชุนุจุฆุฉ ุงูุจูุงูุงุช ุฃุฏูุงู ูุงุณุชุฎุฑุงุฌ ุงูููุฎุต ุงูููุงุฆู")

# ูููุฐุฌ ุฅุฏุฎุงู ุงูุจูุงูุงุช
with st.form("customs_summary_form", clear_on_submit=False):
    col1, col2 = st.columns(2)
    
    with col1:
        driver_name = st.text_input("ุงุณู ุงูุณุงุฆู")
        truck_no = st.text_input("ุฑูู ุงููุงุทุฑุฉ")
        truck_type = st.selectbox("ููุน ุงููุงุทุฑุฉ", ["ูููุงุจ", "ุณุทุญุฉ", "ุฌูุงูุจ", "ุฏููุง", "ุขุฎุฑ"])
        route = st.text_input("ุฎุท ุงูุณูุฑ (ูู - ุฅูู)")

    with col2:
        report_date = st.date_input("ุงูุชุงุฑูุฎ", datetime.now())
        # ููุง ูุฏุฎู ุนุฏุฏ ุงูุฃููุงุณ ูู ูู ุฏูุนุฉ ุฃู ุฅุฌูุงูู ูุจุงุดุฑ
        bags_per_batch = st.text_input("ุนุฏุฏ ุงูุฃููุงุณ (ูุซูุงู: 500+300+200 ุฃู ุฑูู ูุงุญุฏ)", help="ููููู ูุชุงุจุฉ ุฃุฑูุงู ูุจููููุง ุนูุงูุฉ +")
        statement_ref = st.text_input("ุฑูู ุงูุจูุงู ุงูุฌูุฑูู")

    submit = st.form_submit_button("ุฅุตุฏุงุฑ ุงูููุฎุต ูุญุณุงุจ ุงูุฅุฌูุงูู")

# ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุงูุญุณุงุจ ุงูุชููุงุฆู
if submit:
    try:
        # ููุฏ ุฐูู ูุญุณุงุจ ุงูุฅุฌูุงูู ุฅุฐุง ุฃุฏุฎู ุงููุณุชุฎุฏู ุฃุฑูุงูุงู ุจูููุง ุนูุงูุฉ +
        total_bags = sum([float(x.strip()) for x in bags_per_batch.split('+')]) if bags_per_batch else 0
        
        st.success("โ ุชู ุฅุตุฏุงุฑ ููุฎุต ุงูุจูุงู ุจูุฌุงุญ")
        
        # ุนุฑุถ ุงูููุฎุต ูู ุฌุฏูู ููุณู
        summary_data = {
            "ุงูุชุงุฑูุฎ": [report_date],
            "ุฑูู ุงูุจูุงู": [statement_ref],
            "ุงูุณุงุฆู": [driver_name],
            "ุฑูู ุงููุงุทุฑุฉ": [truck_no],
            "ููุนูุง": [truck_type],
            "ุฎุท ุงูุณูุฑ": [route],
            "ุฅุฌูุงูู ุงูุฃููุงุณ": [f"{total_bags:,.0f} ููุณ"]
        }
        
        df = pd.DataFrame(summary_data)
        st.table(df)
        
        # ููุฒุฉ ุฅุถุงููุฉ: ุชูุจูู ุฅุฐุง ูุงู ุงูุนุฏุฏ ุถุฎูุงู
        if total_bags > 1000:
            st.warning("โ๏ธ ููุงุญุธุฉ: ุงููููุฉ ุชุชุฌุงูุฒ 1000 ููุณุ ูุฑุฌู ุงูุชุฃูุฏ ูู ูุทุงุจูุฉ ุงูุญูููุฉ.")
            
    except ValueError:
        st.error("โ ุฎุทุฃ ูู ุฅุฏุฎุงู ุนุฏุฏ ุงูุฃููุงุณ. ูุฑุฌู ูุชุงุจุฉ ุฃุฑูุงู ููุท (ูุซุงู: 500 ุฃู 500+200)")

